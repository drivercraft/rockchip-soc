# RK3588 æ–‡æ¡£ç´¢å¼•

æœ¬ç›®å½•åŒ…å« RK3588 SoC çš„æŠ€æœ¯æ–‡æ¡£å’Œå®ç°è¯´æ˜ã€‚

## ğŸ“š æ–‡æ¡£åˆ—è¡¨

### æ ¸å¿ƒæ–‡æ¡£

1. **[PLL.md](PLL.md)** - PLL æ—¶é’Ÿé…ç½®å®Œæ•´è¯´æ˜
2. **[TEST_REPORT.md](TEST_REPORT.md)** - PLL é…ç½®æµ‹è¯•æŠ¥å‘Š
3. **[CRU_INIT_VERIFICATION.md](CRU_INIT_VERIFICATION.md)** - CRU åˆå§‹åŒ–éªŒè¯
4. **[PLL_READING.md](PLL_READING.md)** - PLL å¯„å­˜å™¨è¯»å–å®ç°
5. **[REFACTOR_2025-12-31.md](REFACTOR_2025-12-31.md)** - Cru æ¨¡å—æ•´åˆé‡æ„

**æ³¨æ„**: `PLL_ID_MAPPING.md` å·²è¿‡æ—¶,å› ä¸º PllId ä¼˜åŒ–å·²æ¶ˆé™¤åŒé‡ ID ç³»ç»Ÿçš„æ··æ·†ã€‚è¯¦è§ [PLL.md#è®¾è®¡äº®ç‚¹](PLL.md#è®¾è®¡äº®ç‚¹)ã€‚

## ğŸ“– æ–‡æ¡£è¯´æ˜

### CRU_INIT_VERIFICATION.md - CRU åˆå§‹åŒ–éªŒè¯

åŒ…å«å†…å®¹:
- u-boot `rk3588_clk_init()` é…ç½®åˆ†æ
- Rust å®ç°çš„å¯„å­˜å™¨éªŒè¯é€»è¾‘
- å•å…ƒæµ‹è¯•è¦†ç›–
- Debug è¾“å‡ºç¤ºä¾‹
- å¯„å­˜å™¨åœ°å€æ˜ å°„

**é€‚åˆ**: éœ€è¦äº†è§£ CRU åˆå§‹åŒ–å’ŒéªŒè¯é€»è¾‘çš„å¼€å‘è€…

### PLL.md - PLL æ—¶é’Ÿé…ç½®

åŒ…å«å†…å®¹:
- 9 ä¸ª PLL çš„åˆ—è¡¨å’Œç”¨é€”
- å¯„å­˜å™¨æ˜ å°„è¡¨
- é¢‘ç‡è®¡ç®—å…¬å¼ (æ•´æ•°å’Œå°æ•°åˆ†é¢‘)
- 17 ä¸ªé¢„è®¾é¢‘ç‡é…ç½®
- ä½¿ç”¨ç¤ºä¾‹å’Œä»£ç ç‰‡æ®µ
- **è®¾è®¡äº®ç‚¹**: PllId ä¼˜åŒ–è¯´æ˜
- ä¸ u-boot çš„å¯¹æ¯”

**é€‚åˆ**: éœ€è¦äº†è§£ RK3588 PLL ç¡¬ä»¶é…ç½®çš„å¼€å‘è€…

### TEST_REPORT.md - æµ‹è¯•æŠ¥å‘Š

åŒ…å«å†…å®¹:
- 21 ä¸ªå•å…ƒæµ‹è¯•çš„è¦†ç›–è¯´æ˜
- å…³é”®ä¿®æ­£å†å²
- ä¸ u-boot C ä»£ç çš„è¯¦ç»†å¯¹æ¯”
- å®Œæ•´çš„æµ‹è¯•æ‰§è¡Œç»“æœ

**é€‚åˆ**: éœ€è¦éªŒè¯å®ç°æ­£ç¡®æ€§æˆ–äº†è§£æµ‹è¯•è¦†ç›–çš„å¼€å‘è€…

### PLL_READING.md - PLL å¯„å­˜å™¨è¯»å–å®ç°

åŒ…å«å†…å®¹:
- PLL å¯„å­˜å™¨è¯»å–çš„å®Œæ•´å®ç°
- ä¸ u-boot `rk3588_pll_get_rate()` çš„å¯¹æ¯”
- é¢‘ç‡è®¡ç®—å…¬å¼è¯¦è§£ (æ•´æ•°å’Œå°æ•°åˆ†é¢‘)
- å•å…ƒæµ‹è¯•è¦†ç›–è¯´æ˜
- ä½¿ç”¨ç¤ºä¾‹å’ŒéªŒè¯æ–¹æ³•

**é€‚åˆ**: éœ€è¦ç†è§£æˆ–è°ƒè¯• PLL é¢‘ç‡è¯»å–çš„å¼€å‘è€…

## ğŸš€ å¿«é€Ÿå¼€å§‹

### æˆ‘æƒ³è¦...

| éœ€æ±‚ | æ¨èæ–‡æ¡£ |
|------|---------|
| äº†è§£ RK3588 PLL ç¡¬ä»¶ | [PLL.md](PLL.md) |
| ä½¿ç”¨ PLL é…ç½® API | [PLL.md](PLL.md#ä½¿ç”¨ç¤ºä¾‹) |
| è®¡ç®— PLL è¾“å‡ºé¢‘ç‡ | [PLL.md](PLL.md#é¢‘ç‡è®¡ç®—å…¬å¼) |
| ç†è§£ PllId è®¾è®¡ | [PLL.md](PLL.md#è®¾è®¡äº®ç‚¹) |
| äº†è§£ä¸ºä»€ä¹ˆåªéœ€ä¸€ä¸ª ID | [PLL.md](PLL.md#è®¾è®¡äº®ç‚¹) |
| éªŒè¯å®ç°æ­£ç¡®æ€§ | [TEST_REPORT.md](TEST_REPORT.md) |
| ç†è§£ PLL å¯„å­˜å™¨è¯»å– | [PLL_READING.md](PLL_READING.md) |
| è¯»å–å¹¶éªŒè¯ PLL é¢‘ç‡ | [PLL_READING.md](PLL_READING.md#rust-å®ç°) |

## âœ¨ è®¾è®¡äº®ç‚¹

### PllId æšä¸¾ä¼˜åŒ–

**ä¹‹å‰çš„é—®é¢˜**: å­˜åœ¨ä¸¤å¥— ID ç³»ç»Ÿ
- C ä»£ç æšä¸¾: ä» 0 å¼€å§‹ (0-8)
- è®¾å¤‡æ ‘ç»‘å®š: ä» 1 å¼€å§‹ (1-9)

**ç°åœ¨çš„è§£å†³æ–¹æ¡ˆ**: ç»Ÿä¸€ä¸ºä¸€ä¸ª ID ç³»ç»Ÿ
```rust
pub enum PllId {
    B0PLL = 1,  // ç›´æ¥åŒ¹é… #define PLL_B0PLL 1
    B1PLL = 2,  // ç›´æ¥åŒ¹é… #define PLL_B1PLL 2
    ...
}
```

**ä¼˜ç‚¹**:
- âœ… æ¶ˆé™¤äº†ä¸¤å¥— ID ç³»ç»Ÿçš„æ··æ·†
- âœ… `PllId` å€¼å¯ç›´æ¥ç”¨äºæ—¶é’Ÿæ¡†æ¶
- âœ… æ— éœ€ `+1/-1` è½¬æ¢
- âœ… è¯­ä¹‰æ¸…æ™°,ä¸æ˜“å‡ºé”™

### å®‰å…¨çš„è®¿é—®æ–¹å¼

é€šè¿‡ `get_pll()` å‡½æ•°å°è£…æ•°ç»„è®¿é—®:
```rust
pub const fn get_pll(id: PllId) -> &'static PllClock {
    &RK3588_PLL_CLOCKS[id as usize - 1]  // å†…éƒ¨å¤„ç†ç´¢å¼•è½¬æ¢
}
```

**æ¨èç”¨æ³•**:
```rust
let gpll = get_pll(PllId::GPLL);  // âœ… æ¨è
```

## ğŸ”— ç›¸å…³ä»£ç 

| ä»£ç æ–‡ä»¶ | è¯´æ˜ |
|---------|------|
| `src/variants/rk3588/cru/pll.rs` | RK3588 PLL é…ç½®å®ç° |
| `src/clock/pll.rs` | é€šç”¨ PLL åŸºç¡€ç±»å‹å®šä¹‰ |
| `src/variants/rk3588/cru/consts.rs` | CRU å¯„å­˜å™¨å¸¸é‡ |

## ğŸ§ª æµ‹è¯•

è¿è¡Œæ‰€æœ‰ RK3588 PLL æµ‹è¯•:

```bash
cd rockchip-soc
cargo test --lib pll
```

é¢„æœŸç»“æœ:
```
test result: ok. 21 passed; 0 failed
```

## ğŸ“š å¤–éƒ¨å‚è€ƒ

1. **u-boot æºç **
   - `drivers/clk/rockchip/clk_rk3588.c`
   - `drivers/clk/rockchip/clk_pll.c`
   - `arch/arm/include/asm/arch-rockchip/cru_rk3588.h`

2. **è®¾å¤‡æ ‘ç»‘å®š**
   - `include/dt-bindings/clock/rk3588-cru.h`

3. **ç¡¬ä»¶æ–‡æ¡£**
   - RK3588 TRM (Technical Reference Manual)

---
**æ–‡æ¡£ç‰ˆæœ¬**: 2.1
**æœ€åæ›´æ–°**: 2025-12-31
**ä¸»è¦å˜æ›´**:
- v2.1: æ–°å¢ PLL_READING.md æ–‡æ¡£,è¯´æ˜ PLL å¯„å­˜å™¨è¯»å–å®ç°
- v2.0: PllId ä¼˜åŒ–ä¸ºä» 1 å¼€å§‹,æ¶ˆé™¤ ID æ··æ·†
